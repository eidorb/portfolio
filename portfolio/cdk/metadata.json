{
    "title": "Portfolio dashboard",
    "description_html": "View dashboard <a href=\"/-/dashboards/portfolio\">here</a>.",
    "plugins": {
        "datasette-dashboards": {
            "portfolio": {
                "title": "Portfolio",
                "charts": {
                    "total": {
                        "title": "Total value",
                        "db": "portfolio",
                        "query": "select printf('AUD $%,d', sum(amount_aud)) as total_aud from asset_classes",
                        "library": "metric",
                        "display": {
                            "field": "total_aud"
                        }
                    },
                    "change": {
                        "title": "Change required to reach target allocations",
                        "db": "portfolio",
                        "query": "select * from changes order by change desc",
                        "library": "vega",
                        "display": {
                            "encoding": {
                                "x": {
                                    "field": "change",
                                    "type": "quantitative",
                                    "stack": null,
                                    "axis": null
                                },
                                "y": {
                                    "field": "asset_class",
                                    "type": "nominal",
                                    "sort": null,
                                    "axis": null
                                },
                                "color": {
                                    "value": "red",
                                    "condition": {
                                        "test": "datum.change>0",
                                        "value": "limegreen"
                                    }
                                }
                            },
                            "layer": [
                                {
                                    "mark": "bar"
                                },
                                {
                                    "mark": {
                                        "type": "text",
                                        "align": {
                                            "expr": "datum.change>0?'right':'left'"
                                        },
                                        "dx": {
                                            "expr": "datum.change>0?-4:4"
                                        }
                                    },
                                    "encoding": {
                                        "text": {
                                            "field": "asset_class"
                                        },
                                        "color": {
                                            "value": "black"
                                        },
                                        "x": {
                                            "datum": 0
                                        }
                                    }
                                },
                                {
                                    "mark": {
                                        "type": "text",
                                        "align": {
                                            "expr": "datum.change>0?'left':'right'"
                                        },
                                        "dx": {
                                            "expr": "datum.change>0?4:-4"
                                        }
                                    },
                                    "encoding": {
                                        "text": {
                                            "field": "change",
                                            "format": ".1%"
                                        },
                                        "color": {
                                            "value": "black"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "steps": {
                        "title": "Steps to rebalance",
                        "db": "portfolio",
                        "query": "select printf('%s %s %s', action, amount, asset) as Action, amount_aud as 'Amount (AUD)', portfolio_percentage as 'Percent of portfolio' from actions",
                        "library": "vega",
                        "display": {
                            "transform": [
                                {
                                    "window": [
                                        {
                                            "op": "row_number",
                                            "as": "row_num"
                                        }
                                    ]
                                },
                                {
                                    "fold": [
                                        "Action",
                                        "Amount (AUD)",
                                        "Percent of portfolio"
                                    ]
                                }
                            ],
                            "mark": "text",
                            "encoding": {
                                "y": {
                                    "field": "row_num",
                                    "type": "ordinal",
                                    "axis": null
                                },
                                "text": {
                                    "field": "value",
                                    "type": "nominal"
                                },
                                "x": {
                                    "field": "key",
                                    "type": "nominal",
                                    "sort": null,
                                    "axis": {
                                        "orient": "top",
                                        "labelAngle": 0,
                                        "labelFontWeight": "bold",
                                        "title": null,
                                        "domain": false,
                                        "ticks": false
                                    },
                                    "scale": {
                                        "padding": 15
                                    }
                                }
                            },
                            "config": {
                                "view": {
                                    "stroke": null
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
