{
    "plugins": {
        "datasette-dashboards": {
            "dashboard": {
                "title": "Portfolio allocations",
                "charts": {
                    "change": {
                        "title": "Change required to reach target allocations",
                        "db": "portfolio",
                        "query": "select * from changes order by change desc",
                        "library": "vega",
                        "display": {
                            "encoding": {
                                "x": {
                                    "field": "change",
                                    "type": "quantitative",
                                    "stack": null,
                                    "axis": null
                                },
                                "y": {
                                    "field": "asset_class",
                                    "type": "nominal",
                                    "sort": null,
                                    "axis": null
                                },
                                "color": {
                                    "value": "red",
                                    "condition": {
                                        "test": "datum.change>0",
                                        "value": "limegreen"
                                    }
                                }
                            },
                            "layer": [
                                {
                                    "mark": "bar"
                                },
                                {
                                    "mark": {
                                        "type": "text",
                                        "align": {
                                            "expr": "datum.change>0?'right':'left'"
                                        },
                                        "dx": {
                                            "expr": "datum.change>0?-4:4"
                                        }
                                    },
                                    "encoding": {
                                        "text": {
                                            "field": "asset_class"
                                        },
                                        "color": {
                                            "value": "black"
                                        },
                                        "x": {
                                            "datum": 0
                                        }
                                    }
                                },
                                {
                                    "mark": {
                                        "type": "text",
                                        "align": {
                                            "expr": "datum.change>0?'left':'right'"
                                        },
                                        "dx": {
                                            "expr": "datum.change>0?4:-4"
                                        }
                                    },
                                    "encoding": {
                                        "text": {
                                            "field": "change",
                                            "format": ".1%"
                                        },
                                        "color": {
                                            "value": "black"
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    }
}
